---
title: "Report Output 5 - Example"
output: html_document
---

```{r code block to load libaries and script, warning=FALSE, message=FALSE}
library('tidyverse')
library('DESeq2')
source('main.R')
```

# Load in counts matrix and sample metadata
```{r code block to load in subsetted data and subsetted sample data, message=FALSE}
counts_subset <- subset_mat('verse_counts.tsv')
coldata_subset <- make_coldata_subset('sample_metadata.csv', 'vP0', 'vAd')
```

# Display head of subsetted counts matrix
```{r code block to display head of subsetted counts matrix}
head(counts_subset)
```

# Display subsetted coldata
```{r code block to display subsetted coldata}
coldata_subset
```

# Run DESeq2 on subsetted counts matrix
```{r codeblock to run DESeq2 on subsetted data, message=FALSE}
results_subset <- deseq2_run(counts_subset, coldata_subset, ~timepoint)
dds <- results_subset$dds_obj
res_ordered <- results_subset$res_mat
res_labeled <- label_results(res_ordered)
```

```{r code block to define figure captions}
caption_1 <- 'Descriptive caption for fig 1'
caption_2 <- 'Descriptive caption for fig 2'
caption_3 <- 'Descriptive caption for fig 3'
caption_4 <- 'Descriptive caption for fig 4'
caption_5 <-  'Descriptive caption for fig 5'
```

# Plot of p-values for all results
```{r code block for p-values plot, fig.cap = caption_1}
pval_plot <- plot_pvals(res_labeled)
pval_plot
```

# Plot of log2FC for differentially expressed genes
```{r code block for log2fc plot, fig.cap = caption_2}
log2fc_plot <- plot_log2fc(res_labeled)
log2fc_plot
```

# Volcano plot of results labeled by significance and directionality
```{r code block for volcano plot, fig.cap = caption_3}
volcano_plot <- plot_volcano(res_labeled)
volcano_plot
```

# Extract out normalized counts for subsetted results
```{r code block to extract normalized counts and top ten DE genes ranked by padj}
top_ten <- return_top_ten(res_labeled)
norm_counts <-  deseq2_norm_counts(dds)
```

# Plot normalized counts for top ten DE genes for subsetted results
```{r code block for normalized counts jitter plot, fig.cap = caption_4}
scatter_norm <- scatter_norm_counts(norm_counts, top_ten)
scatter_norm
```

# Load in full counts matrix and sample data
```{r code block to read in full counts and full sampledata, message=FALSE}
counts_full <- read.table('verse_counts.tsv', header=TRUE, row.names='gene')
coldata_full <- make_full_coldata('sample_metadata.csv')
```

# Run LRT analysis on full counts matrix
```{r codeblock for LRT analysis, message=FALSE}
lrt_results <- deseq2_lrt_run(counts_full, coldata_full, ~timepoint)
dds_lrt <- lrt_results$dds_lrt_obj
res_lrt <- lrt_results$res_lrt_mat
```

# Plot normalized counts from LRT analysis for the top ranked DE gene across timepoints
```{r codeblock for normalized count plot for LRT, fig.cap=caption_5}
time_plot <- plot_lrt_counts(dds_lrt, res_lrt)
time_plot
```